## Q.데드락이란 무엇이며, MySQL에서 데드락이 발생하면 어떻게 처리되나요?

### 데드락

데드락은 둘 이상의 트랜잭션이 서로가 가진 자원을 기다리며 영원히 진행하지 못하는 상태를 의미한다. 

데이터베이스에서는 주로 락(Lock) 때문에 발생하며, 특히 트랜잭션이 여러 테이블·레코드를 서로 다른 순서로 잠글 때 빈번하게 나타난다.

데드락은 다음 4가지 조건이 동시에 만족될 때 발생한다.
- 상호 배제(Mutual Exclusion)
    - 자원(락)은 한 번에 하나의 트랜잭션만 사용 가능
- 점유 대기(Hold and Wait)
    - 이미 자원을 점유한 상태에서 다른 자원을 기다림
- 비선점(No Preemption)
    - 강제로 자원을 빼앗을 수 없음
- 순환 대기(Circular Wait)
    - 트랜잭션들이 원형 구조로 서로의 자원을 기다림

### MySQL(InnoDB)에서의 데드락

- InnoDB는 데드락을 자동 감지한다
    - MySQL의 기본 스토리지 엔진인 InnoDB는 내부적으로 락 대기 그래프(wait-for graph) 를 유지한다.
    - 주기적으로 이 그래프를 검사해 순환 대기(cycle) 가 발견되면 데드락으로 판단한다.
- 데드락 발생 시, 트랜잭션 하나를 즉시 중단(Rollback)
    - InnoDB는 비용이 가장 적은 트랜잭션을 희생시킨다
        - 보통 변경한 row 수가 적은 트랜잭션
	- 해당 트랜잭션은 자동 롤백, 나머지 트랜잭션은 정상적으로 계속 진행
